--- a/lib/IR/PassRegistry.cpp	2026-01-07 14:00:47
+++ b/lib/IR/PassRegistry.cpp	2026-01-07 14:01:11
@@ -111,8 +111,10 @@
     }
   }
 
-  if (ShouldFree)
+  if (ShouldFree) {
+    sys::SmartScopedWriter<true> Guard(Lock);
     ToFree.push_back(std::unique_ptr<const PassInfo>(&Registeree));
+  }
 }
 
 void PassRegistry::addRegistrationListener(PassRegistrationListener *L) {
